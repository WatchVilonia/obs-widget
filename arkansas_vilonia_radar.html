<script>
    // Initialize the map
    let map = L.map('map').setView([35.0834, -92.2071], 8);

    // Base map layer from OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Function to fetch the latest radar timestamp and update the radar layer
    function updateRadarLayer() {
        fetch('https://api.rainviewer.com/public/weather-maps.json')
            .then(response => response.json())
            .then(data => {
                const timestamp = data.radar.past.slice(-1)[0].time || data.radar.nowcast[0].time;

                const radarLayerUrlTemplate = `https://tilecache.rainviewer.com/v2/radar/${timestamp}/{z}/{x}/{y}/256/1_1.png`;

                // Remove existing radar layer if it exists
                if (window.radarLayer) {
                    map.removeLayer(window.radarLayer);
                }

                // Add new radar layer
                window.radarLayer = L.tileLayer(radarLayerUrlTemplate, {
                    opacity: 0.7,
                    attribution: 'Weather data &copy; <a href="https://www.rainviewer.com/">RainViewer</a>'
                }).addTo(map);
            })
            .catch(error => console.error('Error fetching radar data:', error));
    }

    // Initial radar layer update
    updateRadarLayer();

    // Update radar layer every 10 minutes
    setInterval(updateRadarLayer, 600000); // 600,000 ms = 10 minutes

    // Function to switch between Arkansas and Vilonia views
    function switchRadarView() {
        if (map.getZoom() === 8) {
            map.setView([35.0834, -92.1301], 11); // Vilonia view
        } else {
            map.setView([35.0834, -92.2071], 8); // Arkansas view
        }
    }

    // Cycle radar view every 30 seconds
    setInterval(switchRadarView, 30000);
</script>
